name: Profile Engine

on:
  schedule:
    - cron: "0 */2 * * *"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  engine:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Update realtime block
        run: |
          STATUS_TIME=$(date -u +"%Y-%m-%d %H:%M UTC")

          awk '
          /<!-- PROFILE-ENGINE-START -->/ {
            print;
            print "Realtime profile engine status: active";
            print "Last sync: " ENVIRON["STATUS_TIME"];
            skip=1;
            next
          }
          /<!-- PROFILE-ENGINE-END -->/ { skip=0 }
          !skip
          ' README.md > temp.md

          mv temp.md README.md

      - uses: EndBug/add-and-commit@v9
        with:
          message: "engine: realtime profile sync"
          default_author: github_actions
